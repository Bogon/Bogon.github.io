<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="G0fHOrfJn5sHWzmi6ZCcg2aX83myBc-9U1BJZJJDSTU">
  <meta name="baidu-site-verification" content="7gJOLignE2">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.xuebaonline.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“">
<meta property="og:type" content="article">
<meta property="og:title" content="Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“">
<meta property="og:url" content="https://www.xuebaonline.com/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="Char&#39;s Blog">
<meta property="og:description" content="Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.xuebaonline.com/vapor-4-stp2.png">
<meta property="og:image" content="https://cdn.xuebaonline.com/vapor-4-stp1.png">
<meta property="article:published_time" content="2020-06-22T04:14:10.000Z">
<meta property="article:modified_time" content="2020-06-22T13:01:43.310Z">
<meta property="article:author" content="Char">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="Swift">
<meta property="article:tag" content="Swift Vapor">
<meta property="article:tag" content="Swiftå­¦ä¹ ">
<meta property="article:tag" content="Swiftè¿›é˜¶">
<meta property="article:tag" content="Protocols">
<meta property="article:tag" content="åè®®ç¼–ç¨‹">
<meta property="article:tag" content="æ³›å‹">
<meta property="article:tag" content="ç¼–ç¨‹">
<meta property="article:tag" content="å¤šæ€">
<meta property="article:tag" content="Collection Types">
<meta property="article:tag" content="Arrays">
<meta property="article:tag" content="Dictionaries">
<meta property="article:tag" content="Sets">
<meta property="article:tag" content="ä½¿ç”¨é—­åŒ…é›†åˆè¿­ä»£">
<meta property="article:tag" content="Strings">
<meta property="article:tag" content="æ„å»ºè‡ªå·±çš„ç±»å‹">
<meta property="article:tag" content="Structures">
<meta property="article:tag" content="ç»“æ„ä½“">
<meta property="article:tag" content="Methods">
<meta property="article:tag" content="Classes">
<meta property="article:tag" content="Enumerations">
<meta property="article:tag" content="Protocols">
<meta property="article:tag" content="Generics">
<meta property="article:tag" content="è®¿é—®æ§åˆ¶å’Œä»£ç ç»„ç»‡">
<meta property="article:tag" content="è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œä¸‹æ ‡å’Œé”®è·¯å¾„">
<meta property="article:tag" content="æ¨¡å¼åŒ¹é…">
<meta property="article:tag" content="é”™è¯¯å¤„ç†">
<meta property="article:tag" content="Encoding å’Œ Decoding Types">
<meta property="article:tag" content="å†…å­˜ç®¡ç†">
<meta property="article:tag" content="å€¼ç±»å‹å’Œå€¼è¯­ä¹‰">
<meta property="article:tag" content="é¢å‘åè®®ç¼–ç¨‹(OOP)">
<meta property="article:tag" content="é«˜çº§åè®®å’Œæ³›å‹">
<meta property="article:tag" content="Vapor4.0">
<meta property="article:tag" content="Hello Vapor">
<meta property="article:tag" content="Leaf">
<meta property="article:tag" content="åˆ›å»ºåšå®¢æ•°æ®åº“">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.xuebaonline.com/vapor-4-stp2.png">

<link rel="canonical" href="https://www.xuebaonline.com/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“ | Char's Blog</title>
  
    <script>
      function sendPageView() {
        if (CONFIG.hostname !== location.hostname) return;
        var uid = localStorage.getItem('uid') || (Math.random() + '.' + Math.random());
        localStorage.setItem('uid', uid);
        navigator.sendBeacon('https://www.google-analytics.com/collect', new URLSearchParams({
          v  : 1,
          tid: 'UA-165583776-1',
          cid: uid,
          t  : 'pageview',
          dp : encodeURIComponent(location.pathname)
        }));
      }
      document.addEventListener('pjax:complete', sendPageView);
      sendPageView();
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f44aa1d26d8ba6a20c1a09a9cdcd7e3d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Char's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Char's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å¦‚åˆ‡å¦‚ç£‹ï¼Œå¦‚ç¢å¦‚ç£¨ã€‚</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾<span class="badge">124</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">51</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">151</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>æ—¥ç¨‹è¡¨</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.xuebaonline.com/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.xuebaonline.com/blog_avatar.JPG">
      <meta itemprop="name" content="Char">
      <meta itemprop="description" content="æ›¾ç»æ²§æµ·éš¾ä¸ºæ°´ï¼Œé™¤å´å·«å±±ä¸æ˜¯äº‘ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Char's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-06-22 12:14:10" itemprop="dateCreated datePublished" datetime="2020-06-22T12:14:10+08:00">2020-06-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Vapor-4-0/" itemprop="url" rel="index"><span itemprop="name">Vapor 4.0</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>16 åˆ†é’Ÿ</span>
            </span>
            <div class="post-description">Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>æ‚¨å°†äº†è§£Fluent ORMæ¡†æ¶ä»¥åŠä½¿ç”¨æ­¤ç±»å·¥å…·è€Œä¸æ˜¯ç¼–å†™åŸå§‹æ•°æ®åº“æŸ¥è¯¢çš„ä¼˜åŠ¿ã€‚ æˆ‘ä»¬å°†è®¾ç½®ç”±SQLiteé©±åŠ¨ç¨‹åºæ”¯æŒçš„Fluentï¼Œå¹¶ä½¿ç”¨Swiftä¸­çš„å±æ€§åŒ…è£…å™¨å¯¹æ•°æ®åº“å­—æ®µè¿›è¡Œå»ºæ¨¡ã€‚ æˆ‘ä»¬å°†ä¸ºæ•°æ®åº“æä¾›ç§å­ï¼Œç†Ÿæ‚‰è¿ç§»è„šæœ¬å¹¶åœ¨ç½‘ç«™ä¸Šè¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æŸ¥è¯¢æœ¬åœ°æ•°æ®åº“ä¸­çš„åšå®¢æ–‡ç« å¹¶ä½¿ç”¨Leafå‘ˆç°å®ƒä»¬ã€‚</p>
<h1 id="ä»Fluentå…¥æ‰‹"><a href="#ä»Fluentå…¥æ‰‹" class="headerlink" title="ä»Fluentå…¥æ‰‹"></a>ä»Fluentå…¥æ‰‹</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ Fluentä½œä¸ºä¾èµ–é¡¹ã€‚ Fluentæ˜¯æ•°æ®åº“å¼•æ“ä¹‹ä¸Šçš„æŠ½è±¡å±‚ã€‚ ä¸»è¦å®ç°åˆ†ä¸ºç‹¬ç«‹çš„SwiftåŒ…ã€‚ Fluenté™„å¸¦äº†å‡ ä¸ªæ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œæ¯ä¸ªæ•°æ®åº“é©±åŠ¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„SPMå­˜å‚¨åº“ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨SQLiteé©±åŠ¨ç¨‹åºã€‚</p>
<p>è®©æˆ‘ä»¬å°†æ–°çš„ä¾èµ–é¡¹æ·»åŠ åˆ°Package.swiftæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Package.swift */</span></span><br><span class="line"><span class="comment">// swift-tools-version:5.2</span></span><br><span class="line"><span class="keyword">import</span> PackageDescription</span><br><span class="line"><span class="keyword">let</span> package = <span class="type">Package</span>( name: <span class="string">"myProject"</span>, </span><br><span class="line">    platforms: [</span><br><span class="line">    .macOS(.v10_15) ],</span><br><span class="line">    dependencies: [</span><br><span class="line">        <span class="comment">// ğŸ’§ A server-side Swift web framework.</span></span><br><span class="line">        .package(url: <span class="string">"https://github.com/vapor/vapor.git"</span>, from: <span class="string">"4.5.0"</span>), </span><br><span class="line">        .package(url: <span class="string">"https://github.com/vapor/leaf.git"</span>, from: <span class="string">"4.0.0-rc.1"</span>), </span><br><span class="line">        .package(url: <span class="string">"https://github.com/vapor/fluent.git"</span>, from: <span class="string">"4.0.0-rc"</span>), </span><br><span class="line">        .package(url: <span class="string">"https://github.com/vapor/fluent-sqlite-driver.git"</span>, from:  <span class="string">"4.0.0-rc"</span>) ],</span><br><span class="line">    targets: [</span><br><span class="line">        .target(name: <span class="string">"App"</span>, dependencies: [</span><br><span class="line">        .product(name: <span class="string">"Leaf"</span>, package: <span class="string">"leaf"</span>),</span><br><span class="line">        .product(name: <span class="string">"Fluent"</span>, package: <span class="string">"fluent"</span>),</span><br><span class="line">        .product(name: <span class="string">"FluentSQLiteDriver"</span>, package: <span class="string">"fluent-sqlite-driver"</span>), .product(name: <span class="string">"Vapor"</span>, package: <span class="string">"vapor"</span>),</span><br><span class="line">    ]),</span><br><span class="line">    .target(name: <span class="string">"Run"</span>, dependencies: [<span class="string">"App"</span>]), .testTarget(name: <span class="string">"AppTests"</span>, dependencies: [</span><br><span class="line">        .target(name: <span class="string">"App"</span>),</span><br><span class="line">        .product(name: <span class="string">"XCTVapor"</span>, package: <span class="string">"vapor"</span>), ])</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ä¸€æ—¦æ›´æ–°äº†è½¯ä»¶åŒ…æˆ–Xcodeå·²å‡†å¤‡å¥½è¿›è¡Œè§£æè¿‡ç¨‹ï¼Œå°±å¯ä»¥é€šè¿‡å¯¼å…¥æ¡†æ¶å¼€å§‹ä½¿ç”¨Fluentã€‚ Fluentè½¯ä»¶åŒ…åŒ…å«Vaporçš„æ‰©å±•ï¼ŒFluentKitæ˜¯å®é™…çš„æŠ½è±¡å±‚ï¼Œè€ŒFluent[db]Driveræ˜¯ç»™å®šæ•°æ®åº“é©±åŠ¨ç¨‹åºçš„å®ç°ã€‚ æ‚¨ä¸å¿…æ˜¾å¼å¯¼å…¥FluentKitã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/configure.swift */</span></span><br><span class="line"><span class="keyword">import</span> Leaf</span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"><span class="keyword">import</span> FluentSQLiteDriver </span><br><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(<span class="number">_</span> app: Application)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    app.databases.use(.sqlite(.file(<span class="string">"db.sqlite"</span>)), <span class="keyword">as</span>: .sqlite)</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨å¿…é¡»åŒæ—¶å¯¼å…¥Fluentå’ŒFluentSQLiteDriverç¨‹åºåŒ…ï¼Œä½†è¿™æ˜¯å”¯ä¸€å¿…é¡»å¯¼å…¥ç‰¹å®šé©±åŠ¨ç¨‹åºå®ç°çš„åœ°æ–¹ã€‚ SQLiteæ•°æ®åº“å¯ä»¥å°†æ•°æ®ä¿å­˜åˆ°å†…å­˜æˆ–æ–‡ä»¶å­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œä»¥å°†æ‰€æœ‰å†…å®¹æŒä¹…ä¿å­˜åˆ°db.sqliteæ–‡ä»¶ä¸­ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™æ˜¯æ‚¨å”¯ä¸€éœ€è¦ä¸åŸºç¡€é©±åŠ¨ç¨‹åºè¿›è¡Œäº¤äº’çš„æ–‡ä»¶ã€‚ ä»ç°åœ¨å¼€å§‹ï¼Œæ‚¨åªéœ€è¦åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹å¯¼å…¥æŠ½è±¡Fluentæ¨¡å—ï¼Œå°±å¯ä»¥é€šè¿‡ORMæ¡†æ¶ä½¿ç”¨æ•°æ®åº“äº†ã€‚ å¦‚æœè¦åˆ‡æ¢åˆ°æ–°çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œåªéœ€æ›´æ”¹é…ç½®å³å¯ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­è¿›è¡Œã€‚</p>
<h1 id="ä½¿ç”¨æ¨¡å‹"><a href="#ä½¿ç”¨æ¨¡å‹" class="headerlink" title="ä½¿ç”¨æ¨¡å‹"></a>ä½¿ç”¨æ¨¡å‹</h1><p>å»ºæ¨¡åšå®¢æ•°æ®åº“çš„ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªå®ä½“ï¼Œè¯¥å®ä½“å°†ä»£è¡¨åšå®¢æ–‡ç« çš„ç±»åˆ«ã€‚ æ¨¡å‹åŸºæœ¬ä¸Šæ˜¯æ•°æ®åº“ä¸­çš„è¡¨è¡Œã€‚ ä½¿ç”¨Fluentæ¡†æ¶ï¼Œç¼–å†™æ¨¡å‹å®šä¹‰æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œæˆ‘ä»¬åªéœ€è¦éµå¾ªModelåè®®å³å¯ã€‚ BlogCategoryModel.swiftæ–‡ä»¶åº”æ”¾åœ¨Modelsç›®å½•ä¸‹çš„blogæ¨¡å—ä¸­ï¼Œå¹¶ä¸”åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Models/BlogCategoryModel.swift */</span></span><br><span class="line"><span class="keyword">import</span> Vapor </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogCategoryModel</span>: <span class="title">Model</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> schema = <span class="string">"blog_categories"</span></span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">FieldKeys</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">FieldKey</span> &#123; <span class="string">"title"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="type">ID</span>() <span class="keyword">var</span> id: <span class="type">UUID?</span></span><br><span class="line"></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.title) </span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span> </span><br><span class="line">    @<span class="type">Children</span>(<span class="keyword">for</span>: \.$category) </span><br><span class="line">    <span class="keyword">var</span> posts: [<span class="type">BlogPostModel</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(id: <span class="type">UUID?</span> = <span class="literal">nil</span>, title: <span class="type">String</span>) &#123; </span><br><span class="line">        <span class="keyword">self</span>.id = id</span><br><span class="line">        <span class="keyword">self</span>.title = title </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„å±æ€§ï¼Œè¯¥å±æ€§æ˜¯å°†è¦å­˜å‚¨è¿™äº›å®ä½“çš„æ•°æ®åº“è¡¨çš„åç§°ã€‚æ¯è¡Œçš„åç§°å°†ä½¿ç”¨æ–°çš„FieldKeyç±»å‹å®šä¹‰ã€‚æˆ‘æ€»æ˜¯å–œæ¬¢å°†æ‰€æœ‰é”®ä½œä¸ºé™æ€å˜é‡çš„ç»“æ„ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›é”®æ¥åˆ›å»ºåŸºç¡€æ•°æ®åº“æ–¹æ¡ˆã€‚</p>
<p>å­—æ®µæ˜¯Swiftçš„å±æ€§ï¼Œä½¿ç”¨å±æ€§åŒ…è£…å™¨è¡¨ç¤ºæŸ¥è¯¢çš„æ ‡è¯†ç¬¦å’Œæ›´å¤æ‚çš„æ˜ å°„ã€‚è¿™æ„å‘³ç€æ•°æ®åº“å­—æ®µæ ‡è®°æœ‰æ¥è‡ªFluentæ¡†æ¶çš„ç‰¹æ®Šå±æ€§åŒ…è£…å™¨ã€‚ @IDåŒ…è£…å™¨ç”¨äºåˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦ã€‚ @FieldåŒ…è£…å™¨å¯ç”¨äºè®¾ç½®å¸¸è§„å­—æ®µä»¥åŠç›¸åº”çš„é”®ä½œä¸ºæ•°æ®åº“åˆ—ã€‚ @Childrenå’Œ@ParentåŒ…è£…å™¨éƒ½ç”¨äºåœ¨å…³ç³»ä¹‹é—´åˆ›å»ºé“¾æ¥ã€‚æ¯ä¸ªå±æ€§åŒ…è£…å™¨éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å­—æ®µé”®ã€‚</p>
<p>æ¨¡å‹åº”å…·æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦å­—æ®µã€‚åœ¨æœ€æ–°ç‰ˆæœ¬çš„Fluentä¸­ï¼ŒUUIDæ˜¯ç”¨äºæ­¤ç›®çš„çš„é¦–é€‰ç±»å‹ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨Intæˆ–å…¶ä»–ç±»å‹ï¼Œä½†æˆ‘ä¸å»ºè®®è¿™æ ·åšã€‚å½“å‰ï¼ŒUUIDæ˜¯å”¯ä¸€é€‚ç”¨äºæ‰€æœ‰é©±åŠ¨ç¨‹åºçš„idç±»å‹ã€‚</p>
<p>ä½œä¸ºå­—æ®µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Swiftç¼–ç¨‹è¯­è¨€ä¸­çš„ä»»ä½•ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œæšä¸¾ç”šè‡³å¤æ‚çš„JSONå¯¹è±¡ã€‚æ‚¨å¯ä»¥åœ¨æœ‰å…³Fluentçš„æ–‡ç« ä¸­é˜…è¯»æœ‰å…³å—æ”¯æŒç±»å‹çš„æ›´å¤šä¿¡æ¯ã€‚ Modelå®ä¾‹çš„æœ€åä¸€æ­¥æ˜¯å®ç°å¿…è¦çš„initæ–¹æ³•ã€‚æ¨¡å‹å§‹ç»ˆè¢«å®šä¹‰ä¸ºç±»ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨åˆ›å»ºè¿™äº›initæ–¹æ³•ï¼Œå€¼å¾—å¯»æ‰¾ä¸€äº›å¯ä»¥ä¸ºæ‚¨ç”Ÿæˆçš„Xcodeæ‰©å±•ã€‚</p>
<p>åŸºäºæˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼ŒBlogPostModelåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Models/BlogPostModel.swift */</span></span><br><span class="line"><span class="keyword">import</span> Vapor </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogPostModel</span>: <span class="title">Model</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> schema: <span class="type">String</span> = <span class="string">"blog_posts"</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">FieldKeys</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> title: <span class="type">FieldKey</span> &#123; <span class="string">"title"</span> &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> slug: <span class="type">FieldKey</span> &#123; <span class="string">"slug"</span> &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> image: <span class="type">FieldKey</span> &#123; <span class="string">"image"</span> &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> excerpt: <span class="type">FieldKey</span> &#123; <span class="string">"excerpt"</span> &#125; </span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> date: <span class="type">FieldKey</span> &#123; <span class="string">"date"</span> &#125;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> content: <span class="type">FieldKey</span> &#123; <span class="string">"content"</span> &#125; </span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> categoryId: <span class="type">FieldKey</span> &#123; <span class="string">"category_id"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="type">ID</span>() <span class="keyword">var</span> id: <span class="type">UUID?</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.title) <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.slug) <span class="keyword">var</span> slug: <span class="type">String</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.image) <span class="keyword">var</span> image: <span class="type">String</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.excerpt) <span class="keyword">var</span> excerpt: <span class="type">String</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.date) <span class="keyword">var</span> date: <span class="type">Date</span></span><br><span class="line">    @<span class="type">Field</span>(key: <span class="type">FieldKeys</span>.content) <span class="keyword">var</span> content: <span class="type">String</span></span><br><span class="line">    @<span class="type">Parent</span>(key: <span class="type">FieldKeys</span>.categoryId) <span class="keyword">var</span> category: <span class="type">BlogCategoryModel</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(id: <span class="type">UUID?</span> = <span class="literal">nil</span>, title: <span class="type">String</span>, slug: <span class="type">String</span>, image: <span class="type">String</span>, excerpt: <span class="type">String</span>, date: <span class="type">Date</span>, content: <span class="type">String</span>, categoryId: <span class="type">UUID</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.id = id</span><br><span class="line">        <span class="keyword">self</span>.title = title</span><br><span class="line">        <span class="keyword">self</span>.slug = slug</span><br><span class="line">        <span class="keyword">self</span>.image = image </span><br><span class="line">        <span class="keyword">self</span>.excerpt = excerpt </span><br><span class="line">        <span class="keyword">self</span>.date = date</span><br><span class="line">        <span class="keyword">self</span>.content = content </span><br><span class="line">        <span class="keyword">self</span>.$category.id = categoryId</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡ ä¹ç›¸åŒçš„æ¨¡å¼ï¼Œåªæ˜¯æˆ‘ä»¬å°†ç±»åˆ«æ ‡è®°ä¸º@Parentï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ç±»åˆ«ä¸‹æ”¾ç½®å¤šä¸ªå¸–å­ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œå…¶ä¸­å¸–å­ç”¨@Childrenæ ‡è®° åŒ…è£…å™¨ä½¿ç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„å…³é”®è·¯å¾„ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†æ›´å¤šåœ°è®¨è®ºå…³ç³»å’Œå…³é”®è·¯å¾„ï¼Œä½†ç°åœ¨å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ åœ¨å¼€å§‹ä½¿ç”¨è¿™äº›æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€äº›è¿ç§»ã€‚</p>
<h1 id="æ•°æ®åº“è¿ç§»"><a href="#æ•°æ®åº“è¿ç§»" class="headerlink" title="æ•°æ®åº“è¿ç§»"></a>æ•°æ®åº“è¿ç§»</h1><p>è¿ç§»æ˜¯åˆ›å»ºï¼Œæ›´æ–°æˆ–åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åº“è¡¨çš„è¿‡ç¨‹ã€‚ æ¢å¥è¯è¯´ï¼Œæ”¹å˜æ•°æ®åº“æ¶æ„çš„ä¸€åˆ‡éƒ½æ˜¯è¿ç§»ã€‚ æ‚¨åº”è¯¥çŸ¥é“æ‚¨å¯ä»¥æ³¨å†Œå¤šä¸ªè¿ç§»è„šæœ¬ï¼Œå¹¶ä¸”Vaporå°†æŒ‰å­—æ¯é¡ºåºè¿è¡Œå®ƒä»¬ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æ›´å–œæ¬¢å¯¹å®ƒä»¬è¿›è¡Œè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<p>å¦‚æœä½¿ç”¨SQLæ•°æ®åº“ï¼Œåˆ™å¿…é¡»åˆ›å»ºå…·æœ‰é¢„å®šä¹‰æ¶æ„çš„è¡¨æ¥å­˜å‚¨æ•°æ®ã€‚ è¿ç§»æ˜¯æ­¤æ¶æ„åˆ›å»ºçš„è¿‡ç¨‹ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨è¿ç§»è„šæœ¬æ¥æ›´æ”¹æ¶æ„ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨æ¨¡å‹ä¸Šå¼•å…¥äº†æ–°å±æ€§ï¼Œæˆ–è€…ä½¿ç”¨åŸºæœ¬æ¡ç›®ä¸ºæ•°æ®åº“æ·»åŠ äº†ç§å­ã€‚ æ¢å¥è¯è¯´ï¼Œè¿ç§»æ­£åœ¨ä¸ºæ¨¡å‹å‡†å¤‡æ•°æ®åº“ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä¸ºåšå®¢æ¨¡å—åˆ›å»ºè¿ç§»ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Migrations/BlogMigration_v1_0_0.swift */</span></span><br><span class="line"><span class="keyword">import</span> Foundation </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogMigration_v1_0_0</span>: <span class="title">Migration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(on database: Database)</span></span> -&gt; <span class="type">EventLoopFuture</span>&lt;<span class="type">Void</span>&gt; &#123; </span><br><span class="line">        database.eventLoop.flatten([</span><br><span class="line">            database.schema(<span class="type">BlogCategoryModel</span>.schema) </span><br><span class="line">            .id()</span><br><span class="line">            .field(<span class="type">BlogCategoryModel</span>.<span class="type">FieldKeys</span>.title, .string, .<span class="keyword">required</span>)</span><br><span class="line">            .create(), </span><br><span class="line">        database.schema(<span class="type">BlogPostModel</span>.schema)</span><br><span class="line">            .id()</span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.title, .string, .<span class="keyword">required</span>) </span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.slug, .string, .<span class="keyword">required</span>) </span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.image, .string, .<span class="keyword">required</span>) </span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.excerpt, .string, .<span class="keyword">required</span>) </span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.date, .datetime, .<span class="keyword">required</span>) </span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.content, .string, .<span class="keyword">required</span>)</span><br><span class="line">            .field(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.categoryId, .uuid) </span><br><span class="line">            .foreignKey(<span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.categoryId,</span><br><span class="line">                references: <span class="type">BlogCategoryModel</span>.schema, </span><br><span class="line">                .id, </span><br><span class="line">                onDelete: <span class="type">DatabaseSchema</span>.<span class="type">ForeignKeyAction</span>.setNull, </span><br><span class="line">                onUpdate: .cascade)</span><br><span class="line">            .unique(on: <span class="type">BlogPostModel</span>.<span class="type">FieldKeys</span>.slug) </span><br><span class="line">            .create(),</span><br><span class="line">        ]) </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">revert</span><span class="params">(on database: Database)</span></span> -&gt; <span class="type">EventLoopFuture</span>&lt;<span class="type">Void</span>&gt; &#123; </span><br><span class="line">        database.eventLoop.flatten([</span><br><span class="line">            database.schema(<span class="type">BlogCategoryModel</span>.schema).delete(),</span><br><span class="line">            database.schema(<span class="type">BlogPostModel</span>.schema).delete(), ])</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ¨¡å¼æ„å»ºå™¨å»ºç«‹æ¨¡å‹çš„ç»“æ„ã€‚åœ¨æ•°æ®åº“å¯¹è±¡ä¸Šï¼Œæ‚¨å¯ä»¥é€šè¿‡æä¾›åç§°æ¥å®šä¹‰æ¨¡å¼ï¼Œç„¶åå¿…é¡»åˆ—å‡ºè¦ç”¨ä½œå­˜å‚¨ç©ºé—´çš„å…·æœ‰ç»™å®šç±»å‹çš„æ‰€æœ‰å­—æ®µã€‚é€šè¿‡ä½¿ç”¨eventLoopä¸Šçš„.flattenæ–¹æ³•å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥ä¸€æ¬¡åˆ›å»ºå¤šä¸ªæ–¹æ¡ˆã€‚è¿ç§»ä¹Ÿå¯ä»¥æ’¤æ¶ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»å®ç°è¿˜åŸæ–¹æ³•çš„åŸå› ã€‚</p>
<p>æœ€åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨.foreignKeyæ–¹æ³•å°†çº¦æŸæ·»åŠ åˆ°å­—æ®µã€‚å¦‚æœå…³ç³»å‘ç”Ÿæ›´æ”¹ï¼Œçº¦æŸå¯ä»¥æ›´æ–°æ‚¨çš„æ•°æ®åº“ã€‚æ‚¨å¯ä»¥åœ¨åˆ é™¤å’Œæ›´æ–°æ“ä½œä¸Šè®¾ç½®è‡ªå·±çš„é¦–é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåˆ é™¤çˆ¶ç±»åˆ«ï¼Œåˆ™å¯ä»¥åˆ é™¤æ‰€æœ‰å­ç±»åˆ«ï¼Œæˆ–å°†å¼•ç”¨å­ç±»åˆ«è®¾ç½®ä¸ºnullã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨å­—æ®µä¸Šæ–½åŠ å”¯ä¸€çº¦æŸæ¥ç¡®ä¿å­—æ®µå”¯ä¸€ã€‚</p>
<p>åœ¨å®æ–½ç§å­æ•°æ®è¿ç§»ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¥æœŸæ ¼å¼åŒ–ç¨‹åºï¼Œè¯¥ç¨‹åºå¯ä»¥å°†æ—¥æœŸè½¬æ¢ä¸ºå¹´ä»½å­—ç¬¦ä¸²ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä»…å°†ç»™å®šåšå®¢æ–‡ç« çš„å¹´ä»½å­˜å‚¨ä¸ºæ—¥æœŸã€‚æ‚¨å¯ä»¥å°†æ­¤æ—¥æœŸæ ¼å¼æ‰©å±•åæ”¾åœ¨App/Extensions/DateFormatter+year.swiftä¸‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Extensions/DateFormatter+Year.swift */</span></span><br><span class="line"><span class="keyword">import</span> Foundation </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DateFormatter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> year: <span class="type">DateFormatter</span> = &#123; </span><br><span class="line">        <span class="keyword">let</span> formatter = <span class="type">DateFormatter</span>() </span><br><span class="line">        formatter.dateFormat = <span class="string">"y"</span> </span><br><span class="line">        <span class="keyword">return</span> formatter</span><br><span class="line">    &#125;() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…ˆå‰å®šä¹‰çš„ä¼ªæ•°æ®è½¬æ¢ä¸ºæ•°æ®åº“ç§å­ã€‚ æˆ‘ä»¬åªéœ€è¦æ„é€ BlogPostModelå¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ˆå‰ä½¿ç”¨çš„è™šæ‹ŸBlogPostå¯¹è±¡ã€‚ æ‚¨ä¹Ÿå¯ä»¥åˆ é™¤è¯¥ç»“æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦å®ƒã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Migrations/BlogMigration_v1_0_0.swift */</span></span><br><span class="line"><span class="keyword">import</span> Foundation </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogMigration_v1_0_0</span>: <span class="title">Migration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">uncategorizedPosts</span><span class="params">(<span class="keyword">for</span> category: BlogCategoryModel)</span></span> -&gt; [<span class="type">BlogPostModel</span>] &#123;              </span><br><span class="line">        [</span><br><span class="line">            <span class="type">BlogPostModel</span>(title: <span class="string">"California"</span>,</span><br><span class="line">                slug: <span class="string">"california"</span>,</span><br><span class="line">                image: <span class="string">"/images/posts/03.jpg"</span>,</span><br><span class="line">                excerpt: <span class="string">"Voluptates ipsa eos sit distinctio."</span>,</span><br><span class="line">                date: <span class="type">DateFormatter</span>.year.date(from: <span class="string">"2015"</span>)!,</span><br><span class="line">                content: <span class="string">"Et non reiciendis et illum corrupti. Et ducimus optio</span></span><br><span class="line"><span class="string">                    commodi molestiae quis ipsum consequatur. A fugit amet amet qui tenetur. Aut voluptates ut labore consectetur temporibus consectetur. Perferendis et neque id minima voluptatem temporibus a dolor. Eos nihil dignissimos consequuntur et consequuntur nam."</span>,</span><br><span class="line">                categoryId: category.id!),</span><br><span class="line">        ] </span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">islandPosts</span><span class="params">(<span class="keyword">for</span> category: BlogCategoryModel)</span></span> -&gt; [<span class="type">BlogPostModel</span>] &#123; [</span><br><span class="line">            <span class="type">BlogPostModel</span>(title: <span class="string">"Indonesia"</span>, slug: <span class="string">"indonesia"</span>,</span><br><span class="line">                image: <span class="string">"/images/posts/05.jpg"</span>,</span><br><span class="line">                excerpt: <span class="string">"Et excepturi id harum ipsam doloremque."</span>,</span><br><span class="line">                date: <span class="type">DateFormatter</span>.year.date(from: <span class="string">"2019"</span>)!,</span><br><span class="line">                content: <span class="string">"Accusantium amet vero numquam tenetur sit quidem ut.</span></span><br><span class="line"><span class="string">                    Officiis in iste adipisci corporis. Nisi aut consequatur laudantium et veritatis aut amet officiis. Repellat sapiente quis cupiditate veniam est. Est tempora molestiae voluptatum excepturi eum. Eos provident labore quidem ipsam."</span>,</span><br><span class="line">                categoryId: category.id!),</span><br><span class="line"></span><br><span class="line">            <span class="type">BlogPostModel</span>(title: <span class="string">"Mauritius"</span>, slug: <span class="string">"mauritius"</span>,</span><br><span class="line">                image: <span class="string">"/images/posts/04.jpg"</span>,</span><br><span class="line">                excerpt: <span class="string">"Pariatur debitis quod occaecati quidem. "</span>, </span><br><span class="line">                date: <span class="type">DateFormatter</span>.year.date(from: <span class="string">"2016"</span>)!,</span><br><span class="line">                content: <span class="string">"Enim et a ex quisquam qui sed fuga consectetur. Dolorem et eum non dicta modi tempora facilis. Totam doloremque. Libero   consequuntur et distinctio esse a provident est sunt. Rerum  quibusdam blanditiis optio dolores repudiandae magni autem consectetur. Fugit quis sed autem."</span>,</span><br><span class="line">                categoryId: category.id!),</span><br><span class="line"></span><br><span class="line">            <span class="type">BlogPostModel</span>(title: <span class="string">"The Maldives"</span>, slug: <span class="string">"the-maldives"</span>,</span><br><span class="line">                image: <span class="string">"/images/posts/02.jpg"</span>,</span><br><span class="line">                excerpt: <span class="string">"Possimus est labore recusandae asperiores fuga sequisit."</span>,</span><br><span class="line">                date: <span class="type">DateFormatter</span>.year.date(from: <span class="string">"2014"</span>)!,</span><br><span class="line">                content: <span class="string">"Dignissimos mollitia doloremque omnis repellendus quibusdam ut amet. Autem vitae enim consequuntur. Quis quo esse numquam doloremque esse.</span></span><br><span class="line"><span class="string">                Neque accusantium sint tempore distinctio. Dolorem quibusdam et ab impedit necessitatibus cum. Eius voluptatem ducimus velit non."</span>,</span><br><span class="line">                categoryId: category.id!),</span><br><span class="line">            <span class="type">BlogPostModel</span>(title: <span class="string">"Sri Lanka"</span>, slug: <span class="string">"sri-lanka"</span>,</span><br><span class="line">                image: <span class="string">"/images/posts/01.jpg"</span>,</span><br><span class="line">                excerpt: <span class="string">"Ratione est quo nemo dolor placeat dolore."</span>,</span><br><span class="line">                date: <span class="type">DateFormatter</span>.year.date(from: <span class="string">"2014"</span>)!,</span><br><span class="line">                content: <span class="string">"Deserunt nulla culpa aspernatur ea a accusantium quia</span></span><br><span class="line"><span class="string">                quibusdam. Ducimus delectus ea ipsa quisquam aut in deleniti quia. Error aliquam harum earum. Quos dignissimos dolores ratione illo. Dolores velit sunt sed quas quis itaque sit omnis. Molestias explicabo aut eum amet blanditiis quia similique soluta."</span>,</span><br><span class="line">            ] </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥ä½¿ç”¨ç§å­åŠŸèƒ½åœ¨ç°æœ‰ç±»åˆ«ä¸‹åˆ›å»ºå¸–å­ã€‚ æ‰€æœ‰è¿™äº›éƒ½åº”è¯¥åœ¨å‡†å¤‡ä½¿ç”¨æ¶æ„ä¹‹åå‘ç”Ÿã€‚ åœ¨Flattenæ•°ç»„ä¸­å®Œæˆå—ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.flatMapå‡½æ•°æ‰§è¡Œå…¶ä»–æ“ä½œã€‚ é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿ç§»æœŸé—´å°†å¿…è¦çš„æ•°æ®æ¨¡å‹åˆ›å»ºä¸ºè¡¨è¡Œï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Migrations/BlogMigration_v1_0_0.swift */</span></span><br><span class="line"><span class="keyword">import</span> Foundation </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogMigration_v1_0_0</span>: <span class="title">Migration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(on database: Database)</span></span> -&gt; <span class="type">EventLoopFuture</span>&lt;<span class="type">Void</span>&gt; &#123; </span><br><span class="line">        database.eventLoop.flatten([</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        ]).flatMap &#123;</span><br><span class="line">            <span class="keyword">let</span> defaultCategory = <span class="type">BlogCategoryModel</span>(title: <span class="string">"Uncategorized"</span>) </span><br><span class="line">            <span class="keyword">let</span> islandsCategory = <span class="type">BlogCategoryModel</span>(title: <span class="string">"Islands"</span>) </span><br><span class="line">            <span class="keyword">return</span> [defaultCategory, islandsCategory].create(on: database) </span><br><span class="line">                    .flatMap &#123; [<span class="keyword">unowned</span> defaultCategory] <span class="keyword">in</span></span><br><span class="line">                            <span class="keyword">let</span> posts = <span class="keyword">self</span>.uncategorizedPosts(<span class="keyword">for</span>: defaultCategory) + <span class="keyword">self</span>.islandPosts(<span class="keyword">for</span>: islandsCategory)</span><br><span class="line">                        <span class="keyword">return</span> posts.create(on: database) </span><br><span class="line">                    &#125;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€æ­¥æ˜¯æ³¨å†Œæˆ‘ä»¬çš„è¿ç§»è„šæœ¬ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥åœ¨éœ€è¦æ—¶è¿è¡Œå®ƒã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ›´æ”¹configureæ–¹æ³•ï¼Œä½†æ˜¯åœ¨ç»§ç»­å‰è¿›ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ç¨ä½œæ”¹åŠ¨ã€‚</p>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å·²å°†è·¯ç”±å™¨æ³¨å†Œåœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªè·¯ç”±å™¨ï¼Œä¼¼ä¹å®ƒä»¬ä¹Ÿå¯ä»¥è¿›è¡Œè¿ç§»ã€‚ æˆ‘ä»¬åº”è¯¥æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªå‘½ä»¤æ¨¡å¼ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåè®®æ¥è¡¨ç¤ºè¿™äº›ä¸œè¥¿çš„åŸå› ã€‚<br>åœ¨Modulesç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºModule.swiftçš„æ–°æ–‡ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Module.swift */</span></span><br><span class="line"><span class="keyword">import</span> Vapor </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Module</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> router: <span class="type">RouteCollection?</span> &#123; <span class="keyword">get</span> &#125; </span><br><span class="line">    <span class="keyword">var</span> migrations: [<span class="type">Migration</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(<span class="number">_</span> app: Application)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Module</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> router: <span class="type">RouteCollection?</span> &#123; <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> migrations: [<span class="type">Migration</span>] &#123; [] &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(<span class="number">_</span> app: Application)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> migration <span class="keyword">in</span> <span class="keyword">self</span>.migrations &#123;</span><br><span class="line">            app.migrations.add(migration)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> router = <span class="keyword">self</span>.router &#123;</span><br><span class="line">            <span class="keyword">try</span> router.boot(routes: app.routes) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¨¡å—æ˜¯å¯ä»¥è¿”å›è·¯ç”±å™¨ï¼Œè¿ç§»è„šæœ¬çš„ä¸œè¥¿ã€‚ æ‚¨å°†çœ‹åˆ°ï¼Œç¨åæˆ‘ä»¬å°†ä½¿ç”¨å…¶ä»–ä¸€äº›æ‰©å±•æ¥å£ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨åè®®ä¸Šå®šä¹‰çš„é…ç½®æ–¹æ³•éå†æ¨¡å—å¹¶é…ç½®æ‰€æœ‰å†…å®¹ã€‚ æˆ‘ä»¬å¯ä»¥ä¸ºconfigureæ–¹æ³•æä¾›é»˜è®¤å®ç°ï¼Œå› æ­¤æ¨¡å—ä¸å¿…è¿™æ ·åšã€‚</p>
<p>ç°åœ¨ï¼Œåœ¨Frontendç›®å½•ä¸­å®ç°ä¸€ä¸ªFrontendModuleå¯¹è±¡æ–‡ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Frontend/FrontendModule.swift */</span></span><br><span class="line"><span class="keyword">import</span> Vapor </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FrontendModule</span>: <span class="title">Module</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> router: <span class="type">RouteCollection?</span> &#123; </span><br><span class="line">        <span class="type">FrontendRouter</span>()</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€ä¸ªæ˜¯Blogæ–‡ä»¶å¤¹ä¸­çš„BlogModuleã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/BlogModule.swift *</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> Vapor </span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogModule</span>: <span class="title">Module</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> router: <span class="type">RouteCollection?</span> &#123; </span><br><span class="line">        <span class="type">BlogRouter</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> migrations: [<span class="type">Migration</span>] &#123; </span><br><span class="line">        [<span class="type">BlogMigration_v1_0_0</span>(), ]</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬å°†ç¨ç¨æ›´æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥éšæ—¶åˆ é™¤åŸå§‹è·¯ç”±æ³¨å†Œï¼Œå› ä¸ºä»ç°åœ¨å¼€å§‹ï¼Œè¯¥æ¨¡å—å°†å¤„ç†æ‰€æœ‰äº‹æƒ…ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/configure.swift */</span></span><br><span class="line"><span class="keyword">import</span> Leaf</span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"><span class="keyword">import</span> FluentSQLiteDriver </span><br><span class="line"><span class="keyword">import</span> Vapor</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">(<span class="number">_</span> app: Application)</span></span> <span class="keyword">throws</span> &#123; </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">let</span> modules: [<span class="type">Module</span>] = [ <span class="type">FrontendModule</span>(), <span class="type">BlogModule</span>(), ]</span><br><span class="line">    <span class="keyword">for</span> module <span class="keyword">in</span> modules &#123;</span><br><span class="line">        <span class="keyword">try</span> module.configure(app)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å‡†å¤‡è¿ç§»æ•°æ®åº“ã€‚</p>
<p>æ‚¨åº”è¯¥çŸ¥é“ï¼Œå¦‚æœæ‚¨è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å®ƒå°†æ‰§è¡Œä¸€ä¸ªç§°ä¸ºserveçš„å‘½ä»¤ï¼Œä½†æ˜¯æ‚¨ä¸å¿…æ˜¾å¼æä¾›serveå‚æ•°ã€‚ æ­¤å‘½ä»¤è´Ÿè´£å¯åŠ¨åŸºç¡€HTTPæœåŠ¡å™¨ï¼Œå½“æ‚¨è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œserveå‘½ä»¤å°†ä½¿ç”¨ç»™å®šçš„ä¸»æœºåå’Œç«¯å£å¼€å§‹ä¾¦å¬ã€‚ è¿™æ˜¯Vaporä¸­çš„é»˜è®¤å‘½ä»¤ã€‚</p>
<p>ä¸ºäº†è¿è¡Œè¿ç§»ï¼Œæ‚¨å·²ç»ä½¿ç”¨migrationå‚æ•°å¯åŠ¨äº†åº”ç”¨ç¨‹åºï¼Œè¿™å°†è¿è¡Œè¿ç§»è„šæœ¬è€Œä¸æ˜¯å¯åŠ¨WebæœåŠ¡å™¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swift run Run migrate</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.xuebaonline.com/vapor-4-stp2.png" alt="&quot;&quot;"></p>
<p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨Xcodeçš„â€œç¼–è¾‘æ–¹æ¡ˆâ€èœå•ä¸‹è®¾ç½®å‘½ä»¤è¡Œå‚æ•°ï¼š</p>
<p><img src="https://cdn.xuebaonline.com/vapor-4-stp1.png" alt="&quot;&quot;"></p>
<p>å¦‚æœä½¿ç”¨æ­¤è¿ç§»å‚æ•°è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œåˆ™ä¼šçœ‹åˆ°æç¤ºï¼Œæ‚¨å¿…é¡»ç¡®è®¤è¿ç§»ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨è¿è¡Œåº”ç”¨ç¨‹åºæ—¶æä¾›â€“auto-migrateæ ‡å¿—ä½œä¸ºé¢å¤–çš„å‚æ•°æ¥è·³è¿‡ç¡®è®¤ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Xcodeï¼Œåˆ™å¯ä»¥ç®€å•åœ°å¤åˆ¶æ–¹æ¡ˆå¹¶ä¸ºæ¯ä¸ªæ–¹æ¡ˆè®¾ç½®ä¸åŒçš„å‚æ•°ã€‚è¿™æ ·ï¼Œæ‚¨åªéœ€é€‰æ‹©ä¾‹å¦‚è¿ç§»æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯è¿è¡Œ/myProjectæ–¹æ¡ˆã€‚</p>
<p>åœ¨ç¬¬ä¸€æ¬¡è¿ç§»æœŸé—´ï¼ŒFluentå°†åˆ›å»ºä¸€ä¸ªåä¸º_fluent_migrationsçš„å†…éƒ¨è¡¨ã€‚è¿ç§»ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨è¯¥æŸ¥æ‰¾è¡¨æ¥æ£€æµ‹å“ªäº›è¿ç§»å·²ç»æ‰§è¡Œï¼Œä»¥åŠä¸‹æ¬¡è¿è¡Œmigrationå‘½ä»¤æ—¶éœ€è¦å®Œæˆå“ªäº›è¿ç§»ã€‚</p>
<p>è¿ç§»è„šæœ¬æ­£åœ¨åˆ†æ‰¹æ‰§è¡Œã€‚å½“æ‚¨è¿è¡Œè¿ç§»å‘½ä»¤æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰¹å¤„ç†ã€‚æ¯ä¸ªéœ€è¦è¿è¡Œçš„è¿ç§»è„šæœ¬éƒ½å°†å…·æœ‰ç›¸åŒçš„æ‰¹æ¬¡æ ‡è¯†ç¬¦ã€‚ä¸‹æ¬¡è¿è¡Œè¿ç§»å‘½ä»¤æ—¶ï¼ŒVaporå°†æ£€æŸ¥æŸ¥æ‰¾è¡¨ï¼Œå®ƒç¡®å®šéœ€è¦æ‰§è¡Œçš„æ“ä½œï¼Œå¢åŠ æ‰¹æ¬¡æ ‡è¯†ç¬¦ï¼Œè¿è¡Œæ–°çš„è¿ç§»å¹¶å°†å…¶ä¿å­˜åœ¨è¡¨ä¸­ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œå¸¦æœ‰â€“revertæ ‡å¿—çš„migrationå‘½ä»¤æ¥è¿˜åŸæœ€åä¸€æ‰¹è¿ç§»ã€‚ è¿™å°†ä»…è¿˜åŸæœ€åä¸€æ‰¹è¿ç§»ï¼Œå› æ­¤æ‚¨å¯èƒ½å¿…é¡»è¿è¡Œå¤šæ¬¡æ‰èƒ½è¿˜åŸæ‰€æœ‰å†…å®¹ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä»ç£ç›˜ä¸Šåˆ é™¤æ•´ä¸ªSQLiteæ•°æ®åº“æ–‡ä»¶ï¼Œè¿™å°†é‡ç½®æ‰€æœ‰å†…å®¹ã€‚</p>
<p>æ•°æ®åº“æ–‡ä»¶å°†åœ¨å·¥ä½œç›®å½•ä¸‹åˆ›å»ºã€‚ æµè§ˆSQLiteæ–‡ä»¶éå¸¸å®¹æ˜“ï¼Œæ‚¨å¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨<a href="https://sqlitebrowser.org" target="_blank" rel="noopener">https://sqlitebrowser.org</a> åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡brew cask install db-browser-for-sqliteå‘½ä»¤å®‰è£…å®ƒã€‚</p>
<h1 id="æŸ¥è¯¢å’Œæ¸²æŸ“"><a href="#æŸ¥è¯¢å’Œæ¸²æŸ“" class="headerlink" title="æŸ¥è¯¢å’Œæ¸²æŸ“"></a>æŸ¥è¯¢å’Œæ¸²æŸ“</h1><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç§å­æ•°æ®è¿›è¡Œå·¥ä½œè¿ç§»äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä½¿ç”¨Fluentæ£€ç´¢æ¨¡å‹äº†ã€‚ å¦ä¸€ä»¶äº‹æ˜¯ï¼Œæˆ‘ä¸å–œæ¬¢ä½¿ç”¨ç›´æ¥æ¥è‡ªFluentå±‚çš„æ¨¡å‹æ¥æ¸²æŸ“è§†å›¾ï¼Œä½†æˆ‘æ›´å–œæ¬¢æœ‰ä¸€ä¸ªViewContextå¯¹è±¡ï¼Œå¯ä»¥å®‰å…¨åœ°å°†å…¶ä½œä¸ºLeafçš„ä¸Šä¸‹æ–‡é¡¹ä¼ é€’ã€‚ è¿™æ˜¯å› ä¸ºæ¨¡å‹å¯ä»¥åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåªè€ƒè™‘å¸¦æœ‰å¯†ç å“ˆå¸Œçš„ç”¨æˆ·ï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªå¯ç¼–ç çš„è§†å›¾ä¸Šä¸‹æ–‡å¹¶å°†æ•°æ®åº“æ¨¡å‹æ˜ å°„åˆ°å…¶ä¸­ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Models/BlogCategoryModel.swift */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">BlogCategoryModel</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ViewContext</span>: <span class="title">Encodable</span> </span>&#123; </span><br><span class="line">        <span class="keyword">var</span> id: <span class="type">String</span></span><br><span class="line">        <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">init</span>(model: <span class="type">BlogCategoryModel</span>) &#123; </span><br><span class="line">            <span class="keyword">self</span>.id = model.id!.uuidString </span><br><span class="line">            <span class="keyword">self</span>.title = model.title</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> viewContext: <span class="type">ViewContext</span> &#123; </span><br><span class="line">        .<span class="keyword">init</span>(model: <span class="keyword">self</span>) </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ViewContextç»“æ„æ˜¯ä¸€ä¸ªEncodableå¯¹è±¡ï¼Œå…·æœ‰åŸºäºæ¨¡å‹çš„å±æ€§ã€‚ æ‚¨å¯ä»¥å°†è¯¥æ‰©å±•åæ”¾åœ¨æ¨¡å‹æ—è¾¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ–°æ–‡ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/Models/BlogPostModel.swift */</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">BlogPostModel</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ViewContext</span>: <span class="title">Encodable</span> </span>&#123; </span><br><span class="line">        <span class="keyword">var</span> id: <span class="type">String</span></span><br><span class="line">        <span class="keyword">var</span> title: <span class="type">String</span> </span><br><span class="line">        <span class="keyword">var</span> slug: <span class="type">String</span> </span><br><span class="line">        <span class="keyword">var</span> image: <span class="type">String</span> </span><br><span class="line">        <span class="keyword">var</span> excerpt: <span class="type">String</span> </span><br><span class="line">        <span class="keyword">var</span> date: <span class="type">String</span> </span><br><span class="line">        <span class="keyword">var</span> content: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">init</span>(model: <span class="type">BlogPostModel</span>) &#123; </span><br><span class="line">            <span class="keyword">self</span>.id = model.id!.uuidString </span><br><span class="line">            <span class="keyword">self</span>.title = model.title </span><br><span class="line">            <span class="keyword">self</span>.slug = model.slug </span><br><span class="line">            <span class="keyword">self</span>.image = model.image s</span><br><span class="line">            elf.excerpt = model.excerpt</span><br><span class="line">            <span class="keyword">self</span>.date = <span class="type">DateFormatter</span>.year.string(from: model.date)</span><br><span class="line">            <span class="keyword">self</span>.content = model.content</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">var</span> viewContext: <span class="type">ViewContext</span> &#123; </span><br><span class="line">        .<span class="keyword">init</span>(model: <span class="keyword">self</span>) </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€é¡¹å¾ˆæ— èŠä¸”é‡å¤çš„ä»»åŠ¡ï¼Œä½†æ˜¯è¯·ç›¸ä¿¡æˆ‘ï¼Œé•¿æœŸçš„åŠªåŠ›æ˜¯å€¼å¾—çš„ã€‚ æˆ‘æ€»æ˜¯ä»è§†å›¾ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­å¿½ç•¥å…³ç³»ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¼•èµ·é—®é¢˜ã€‚ æˆ‘æœ‰ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥å¤„ç†è¯¥é—®é¢˜ï¼Œæˆ‘å°†åœ¨çŸ­çŸ­å‡ ç§’é’Ÿå†…å‘æ‚¨å±•ç¤ºã€‚ åœ¨BlogFrontendControllerä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è¿›è¡Œä¸€äº›æ›´æ”¹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/BlogFrontendController.swift */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogFrontendController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">blogView</span><span class="params">(req: Request)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">EventLoopFuture</span>&lt;<span class="type">View</span>&gt; &#123; </span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Context</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">PostWithCategory</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> category: <span class="type">BlogCategoryModel</span>.<span class="type">ViewContext</span> </span><br><span class="line">                    <span class="keyword">var</span> post: <span class="type">BlogPostModel</span>.<span class="type">ViewContext</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line">            <span class="keyword">let</span> items: [<span class="type">PostWithCategory</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">BlogPostModel</span>.query(on: req.db) </span><br><span class="line">                .<span class="built_in">sort</span>(\.$date, .descending) </span><br><span class="line">                .with(\.$category)</span><br><span class="line">                .all()</span><br><span class="line">                .mapEach &#123; </span><br><span class="line">                    <span class="type">Context</span>.<span class="type">PostWithCategory</span>(category: $<span class="number">0</span>.category.viewContext, post: $<span class="number">0</span>.viewContext) &#125;</span><br><span class="line">                .flatMap &#123; </span><br><span class="line">                    <span class="keyword">let</span> context = <span class="type">Context</span>(title: <span class="string">"myPage - Blog"</span>, items: $<span class="number">0</span>) </span><br><span class="line">                    <span class="keyword">return</span> req.view.render(<span class="string">"blog"</span>, context) &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨åº”è¯¥æ³¨æ„çš„ç¬¬ä¸€ä»¶äº‹æ˜¯æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„PostWithCategoryç»“æ„ã€‚è¿™æ˜¯åšå®¢æ–‡ç« å’Œç›¸å…³ç±»åˆ«å¯¹è±¡çš„å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›é¡¹ç›®å­˜å‚¨åœ¨Contextå¯¹è±¡ä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Modelä¸Šä½¿ç”¨é™æ€æŸ¥è¯¢æ–¹æ³•ï¼Œä»¥ä»æ•°æ®åº“è¡¨ä¸­è¯·æ±‚å®ä½“ã€‚è¿™å°†è¿”å›ä¸€ä¸ªæŸ¥è¯¢æ„å»ºå™¨å®ä¾‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ·»åŠ å„ç§è¿‡æ»¤å™¨ï¼Œé™åˆ¶å’Œæ’åºé€‰é¡¹æ¥è¿›è¡Œè°ƒæ•´ã€‚ä½¿ç”¨withæ–¹æ³•ï¼Œå¯ä»¥å°†å…³ç³»å¯¹è±¡åŠ è½½åˆ°æ¨¡å‹ä¸­ã€‚ allæ–¹æ³•å°†æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†è¯·æ±‚çš„è¡Œä½œä¸ºModelå¯¹è±¡è¿”å›ã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°æ›´å¤šæ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mapEachå‡½æ•°å°†æ¯ä¸ªé¡¹ç›®è½¬æ¢ä¸ºæ–°çš„é¡¹ç›®ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šä¸‹æ–‡é¡¹æ¥å‘ˆç°è§†å›¾ã€‚è¿™æ•´ä¸ªé“¾è¿”å›ä¸€ä¸ªEventLoopFâ€‹â€‹utureï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨flatMapæ–¹æ³•ä½¿ç”¨è¯¥å—ä¸­çš„é¡¹ç›®æ¥å‘ˆç°è§†å›¾ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ç¨å¾®æ›´æ”¹ä¸€ä¸‹ç›¸åº”çš„åšå®¢è§†å›¾ï¼Œå› ä¸ºitemsæ•°ç»„ç°åœ¨æ˜¯PostWithCategoryå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•è®¿é—®postï¼†categoryã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Resources/Views/blog.leaf */</span></span><br><span class="line">#extend(<span class="string">"index"</span>): </span><br><span class="line">    #export(<span class="string">"body"</span>):</span><br><span class="line">    &lt;section id=<span class="string">"blog"</span> <span class="class"><span class="keyword">class</span>="<span class="title">wrapper</span>"&gt; </span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Blog</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        #<span class="title">for</span>(<span class="title">item</span> <span class="title">in</span> <span class="title">items</span>):</span></span><br><span class="line"><span class="class">            &lt;<span class="title">article</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">a</span> <span class="title">href</span>="/#(<span class="title">item</span>.<span class="title">post</span>.<span class="title">slug</span>)"&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">img</span> <span class="title">src</span>="#(<span class="title">item</span>.<span class="title">post</span>.<span class="title">image</span>)"&gt; </span></span><br><span class="line"><span class="class">                &lt;<span class="title">h3</span>&gt;#(<span class="title">item</span>.<span class="title">post</span>.<span class="title">title</span>) (#(<span class="title">item</span>.<span class="title">post</span>.<span class="title">date</span>))&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span>&gt;#(<span class="title">item</span>.<span class="title">post</span>.<span class="title">excerpt</span>)&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">class</span>="<span class="title">category</span>"&gt;#(<span class="title">item</span>.<span class="title">category</span>.<span class="title">title</span>)&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">a</span>&gt; </span></span><br><span class="line"><span class="class">            &lt;/<span class="title">article</span>&gt;</span></span><br><span class="line"><span class="class">        #<span class="title">endfor</span></span></span><br><span class="line"><span class="class">    &lt;/<span class="title">section</span>&gt;</span></span><br><span class="line"><span class="class">    #<span class="title">endexport</span> </span></span><br><span class="line"><span class="class">#<span class="title">endextend</span></span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œå¯¹ç»†èŠ‚é¡µé¢æ‰§è¡Œå‡ ä¹å®Œå…¨ç›¸åŒçš„æ“ä½œã€‚ ç¡®ä¿è¿™æ¬¡å¯¼å…¥Fluentæ¡†æ¶ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†å‘Šè¯‰æ‚¨.filter()è¡Œæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºè¡¨è¾¾å¼çš„ç±»å‹æ˜¯æ¨¡æ£±ä¸¤å¯çš„ï¼Œæ²¡æœ‰æ›´å¤šä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Sources/App/Modules/Blog/BlogFrontendController.swift */</span></span><br><span class="line"><span class="keyword">import</span> Fluent</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlogFrontendController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">postView</span><span class="params">(req: Request)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">EventLoopFuture</span>&lt;<span class="type">Response</span>&gt; &#123; </span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Context</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">PostWithCategory</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> category: <span class="type">BlogCategoryModel</span>.<span class="type">ViewContext</span> </span><br><span class="line">                <span class="keyword">var</span> post: <span class="type">BlogPostModel</span>.<span class="type">ViewContext</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line">            <span class="keyword">let</span> item: <span class="type">PostWithCategory</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> slug = req.url.path.trimmingCharacters(<span class="keyword">in</span>: .<span class="keyword">init</span>(charactersIn: <span class="string">"/"</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="type">BlogPostModel</span>.query(on: req.db) </span><br><span class="line">                .<span class="built_in">filter</span>(\.$slug == slug) </span><br><span class="line">                .with(\.$category)</span><br><span class="line">                .first()</span><br><span class="line">                .flatMap &#123; post <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> post = post <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> req.eventLoop.future(req.redirect(to: <span class="string">"/"</span>)) </span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">let</span> item = <span class="type">Context</span>.<span class="type">PostWithCategory</span>(category: post.category.viewContext, post: post.viewContext)</span><br><span class="line">                    <span class="keyword">let</span> context = <span class="type">Context</span>(title: <span class="string">"myPage - \("</span>post.title<span class="string">")"</span>, item: item)</span><br><span class="line">                    <span class="keyword">return</span> req.view.render(<span class="string">"post"</span>, context).encodeResponse(<span class="keyword">for</span>: req) &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PostWithCategoryç»“æ„æ˜¯å¤šä½™çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å…¶ä»ä¸Šä¸‹æ–‡ä¸­ç§»å‡ºï¼Œè¿™æ ·å°±ä¸ä¼šé‡å¤ä»»ä½•ä»£ç ã€‚æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸ä»¥å‰ç›¸åŒçš„æ–¹æ³•æ¥è¯·æ±‚åšå®¢æ–‡ç« æ¨¡å‹ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬é€šè¿‡æœç´¢ä¸€ä¸ªæ¡ç›®æ¥è¿‡æ»¤åˆ—è¡¨ã€‚</p>
<p>ä¸FluentæŸ¥è¯¢æ„å»ºå™¨ç›¸å…³çš„å‡ ä¹æ‰€æœ‰å†…å®¹éƒ½ä½¿ç”¨Swifté”®è·¯å¾„ã€‚é”®è·¯å¾„æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œå¯ä»¥é€šè¿‡åœ¨å±æ€§åç§°å‰ä½¿ç”¨\å­—ç¬¦æ¥æ„é€ å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å§‹ç»ˆä½¿ç”¨\ã€‚$ <field>è¡¨è¾¾å¼æ¥å¼•ç”¨fieldså±æ€§åŒ…è£…å™¨çš„é”®è·¯å¾„ã€‚ä¹ä¸€çœ‹è¿™æœ‰ç‚¹å¥‡æ€ªï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä¹ æƒ¯å®ƒã€‚</p>
<p>ä½¿ç”¨$å‰ç¼€ï¼Œæ‚¨å¯ä»¥è®¿é—®å±æ€§åŒ…è£…å™¨æœ¬èº«ï¼Œè€Œæ— éœ€$ç¬¦å·ï¼Œåˆ™å¯ä»¥å¼•ç”¨å±æ€§çš„keyPathã€‚å½“æˆ‘ä»¬ä½¿ç”¨Fluentè¿‡æ»¤æŸäº›å†…å®¹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›åˆ°è¾¾å±æ€§åŒ…è£…å™¨ï¼Œå› æ­¤æ¡†æ¶å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨åŒ…è£…å™¨ä¸Šçš„å­—æ®µåç§°å’ŒåŒ…è£…çš„å€¼æ¥åŸºäºå®ƒä»¬åˆ›å»ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>
<p>åœ¨è¿‡æ»¤åšå®¢æ–‡ç« åˆ—è¡¨ä¹‹åï¼Œæˆ‘ä»¬åŠ è½½ç±»åˆ«å¯¹è±¡å¹¶è¯·æ±‚ç»“æœçš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å…ƒç´ ï¼Œæˆ‘ä»¬åªéœ€é‡å®šå‘åˆ°ä¸»å±å¹•ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†åšå®¢æ–‡ç« è½¬æ¢ä¸ºè§†å›¾ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æ›´æ”¹post.leafæ–‡ä»¶ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FILE:</span></span><br><span class="line"><span class="comment">* Resources/Views/post.leaf */</span></span><br><span class="line"><span class="selector-id">#extend</span>("<span class="selector-tag">index</span>"): </span><br><span class="line">    <span class="selector-id">#export</span>("<span class="selector-tag">body</span>"):</span><br><span class="line">    &lt;section id="blog" class="wrapper"&gt;</span><br><span class="line">        &lt;img src="#(item.post.image)"&gt; </span><br><span class="line">        &lt;h2&gt;#(item.post.title) (#(item.post.date))&lt;/h2&gt; </span><br><span class="line">        &lt;p&gt;#(item.post.excerpt)&lt;/p&gt;</span><br><span class="line">        &lt;p class="category"&gt;#(item.post.category)&lt;/p&gt; </span><br><span class="line">        &lt;p&gt;#(item.post.content)&lt;/p&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    <span class="selector-id">#endexport</span> </span><br><span class="line"><span class="selector-id">#endextend</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°åˆ é™¤æ—§çš„BlogPost.swiftå’ŒBlogRepository.swiftæ–‡ä»¶ã€‚ å†æ¬¡è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Xcodeï¼Œè¯·ä¸è¦å¿˜è®°ç¦ç”¨migrationå‚æ•°ã€‚ æ‚¨åº”è¯¥çœ‹åˆ°åšå®¢ç°åœ¨æ­£åœ¨ä½¿ç”¨çœŸå®çš„SQLiteæ•°æ®åº“è¿è¡Œã€‚</p>
<h1 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h1><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†Fluentçš„å·¥ä½œæ–¹å¼ï¼Œå·²æˆåŠŸåœ°å°†åšå®¢å­˜å‚¨è¿ç§»åˆ°äº†æ­£å¸¸çš„SQLiteæ•°æ®åº“ä¸­ã€‚ æˆ‘ä»¬å·²ç»äº†è§£äº†æ¨¡å¼æ„å»ºå™¨ä»¥åŠå®ƒä»¬å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ä¸ºæ¨¡å‹åˆ›å»ºç±»å‹å®‰å…¨çš„SQLæ•°æ®åº“è¡¨ã€‚ æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¾ˆå¤šæœ‰å…³é€šè¿‡å±æ€§åŒ…è£…å™¨ä½¿ç”¨å„ç§å­—æ®µç±»å‹å’Œå…³ç³»å¯¹æ•°æ®åº“å®ä½“å»ºæ¨¡çš„çŸ¥è¯†ã€‚ é™¤äº†å½“å‰çš„æ¨¡å—åŒ–ç»“æ„ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†Moduleåè®®ï¼Œå¹¶ä¸”äº†è§£äº†ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†ç¦»çš„è§†å›¾æ¨¡å‹æ¥å‘ˆç°Fluentå®ä½“æ˜¯ä¸€ä»¶å¥½äº‹ã€‚</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Char å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Char æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5eacc50f0dcd8169" async="async"></script>
  </div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Char
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://www.xuebaonline.com/Vapor%E7%B3%BB%E5%88%97%20(%E5%9B%9B)%20:%20%20%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“">https://www.xuebaonline.com/Vaporç³»åˆ— (å››) :  åˆ›å»ºåšå®¢æ•°æ®åº“/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/Bogon">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/connectme.JPG">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Swift-5-0/" rel="tag"><i class="fa fa-tag"></i> Swift 5.0</a>
              <a href="/tags/Vapor-4-0/" rel="tag"><i class="fa fa-tag"></i> Vapor 4.0</a>
              <a href="/tags/%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> åˆ›å»ºåšå®¢æ•°æ®åº“</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Vapor%E7%B3%BB%E5%88%97%20(%E4%B8%89)%20:%20%E4%BD%BF%E7%94%A8Leaf%E6%9E%84%E5%BB%BA%E7%BD%91%E7%AB%99/" rel="prev" title="Vaporç³»åˆ— (ä¸‰) : ä½¿ç”¨Leafæ„å»ºç½‘ç«™">
      <i class="fa fa-chevron-left"></i> Vaporç³»åˆ— (ä¸‰) : ä½¿ç”¨Leafæ„å»ºç½‘ç«™
    </a></div>
      <div class="post-nav-item">
    <a href="/Vapor%E7%B3%BB%E5%88%97%20(%E4%BA%94)%20:%20%20%E4%BD%BF%E7%94%A8session%E8%BF%9B%E8%A1%8Cauthentication/" rel="next" title="Vaporç³»åˆ— (äº”) :  ä½¿ç”¨sessionè¿›è¡Œauthentication">
      Vaporç³»åˆ— (äº”) :  ä½¿ç”¨sessionè¿›è¡Œauthentication <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ä»Fluentå…¥æ‰‹"><span class="nav-number">1.</span> <span class="nav-text">ä»Fluentå…¥æ‰‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä½¿ç”¨æ¨¡å‹"><span class="nav-number">2.</span> <span class="nav-text">ä½¿ç”¨æ¨¡å‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ•°æ®åº“è¿ç§»"><span class="nav-number">3.</span> <span class="nav-text">æ•°æ®åº“è¿ç§»</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æŸ¥è¯¢å’Œæ¸²æŸ“"><span class="nav-number">4.</span> <span class="nav-text">æŸ¥è¯¢å’Œæ¸²æŸ“</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ‘˜è¦"><span class="nav-number">5.</span> <span class="nav-text">æ‘˜è¦</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Char"
      src="https://cdn.xuebaonline.com/blog_avatar.JPG">
  <p class="site-author-name" itemprop="name">Char</p>
  <div class="site-description" itemprop="description">æ›¾ç»æ²§æµ·éš¾ä¸ºæ°´ï¼Œé™¤å´å·«å±±ä¸æ˜¯äº‘ã€‚</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">151</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element">
    <a onclick="Chatra('openChat', true);"><i class="fa fa-comment"></i>
    è”ç³»æˆ‘
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Bogon" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Bogon" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhangqixcu@gmail.com" title="E-Mail â†’ mailto:zhangqixcu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5640441479" title="æ–°æµªå¾®åš â†’ https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5640441479" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/bogonbug" title="CSDN â†’ https:&#x2F;&#x2F;blog.csdn.net&#x2F;bogonbug" rel="noopener" target="_blank"><i class="fab fa-skype fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Bogon" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;Bogon" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/4368897/qizhang" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;4368897&#x2F;qizhang" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      æ¨èé˜…è¯»
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://developer.apple.com/swift/" title="https:&#x2F;&#x2F;developer.apple.com&#x2F;swift&#x2F;" rel="noopener" target="_blank">Swift 5.3</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://developer.apple.com/documentation/objectivec" title="https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;objectivec" rel="noopener" target="_blank">Objective-C</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">è±«ICPå¤‡20011156å·-1 </a>
      <img src="/images/beian.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41172402000135" rel="noopener" target="_blank">è±«å…¬ç½‘å®‰å¤‡41172402000135å· </a>
  </div>

<div class="copyright">
  
  &copy; 2020 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Char</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">åšå®¢å…¨ç«™å…±1.3må­—</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">20:02</span>
</div>

<!--
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5eacc50f0dcd8169" async="async"></script>
  </div>
-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>




  <script>
    (function(d, w, c) {
      w.ChatraID = 'PxGFNHLgjQ3C3Hmpo';
      var s = d.createElement('script');
      w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
      };
      s.async = true;
      s.src = 'https://call.chatra.io/chatra.js';
      if (d.head) d.head.appendChild(s);
    })(document, window, 'Chatra');
  </script>









  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'rfRdmQpsk2Crnz747tDDOu26-gzGzoHsz',
      appKey     : 'eyu1k9BeINgR5FuXzbc969UA',
      placeholder: "å†™å‡ºä½ çš„æƒ³æ³•â€¦â€¦",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>