---
title: é€‚ç”¨äºiOSå¼€å‘äººå‘˜çš„VIPERæœ€ä½³å®è·µ
description: é€‚ç”¨äºiOSå¼€å‘äººå‘˜çš„VIPERæœ€ä½³å®è·µ
permalink: é€‚ç”¨äºiOSå¼€å‘äººå‘˜çš„VIPERæœ€ä½³å®è·µ
copyright: ture
date: 2020-04-28 20:12:33
keywords: iOS,Swift,VIPER, æ¶æ„, architecture, å¯é‡ç”¨
tags:
    - [iOS]
    - [Swift]
    - [VIPER]
    - [æ¶æ„è®¾è®¡]
categories:
    - [iOS]
    - [Swift]
    - [VIPER]
    - [æ¶æ„è®¾è®¡]
---

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºæœ‰å…³å¦‚ä½•æ„å»ºå®Œå…¨åŸºäº ```Swift``` çš„åŸºäº ```VIPER``` çš„ ```iOS``` åº”ç”¨ç¨‹åºçš„å®Œæ•´æŒ‡å—ã€‚

> ***```æç¤º:```***\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ç¯‡æ–‡ç« æœ‰ç‚¹è¿‡æ—¶äº†ï¼Œè¯·æœŸå¾…å¾ˆå¿«ä¼šæœ‰æ–°ç‰ˆæœ¬...

</br>

# **VIPERå…¥é—¨**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é¦–å…ˆï¼Œä½ åº”è¯¥é˜…è¯» [***```å…³äºVIPERæ¶æ„æœ¬èº«çš„æ–‡ç« ï¼ˆç†è®ºä¸Šæ›´æ·±å…¥ï¼‰ ```***](http://www.xuebaonline.com/iOS%20VIPER%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%85%A5%E5%AE%9E%E8%B7%B5/ "")ã€‚ è¿™æ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™çš„æ–‡ç« ï¼Œè§£é‡Šäº†æ‰€æœ‰ ```VIPERç»„ä»¶``` å’Œ ```å†…å­˜ç®¡ç†``` ã€‚  â­ï¸

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½†æ˜¯ï¼Œé‚£ç¯‡æ–‡ç« çš„é—®é¢˜åœ¨äºï¼Œæˆ‘è¿˜æ²¡æœ‰å‘ä½ å±•ç¤ºçœŸæ­£çš„æŠ€æœ¯ç»†èŠ‚ã€‚ ç”¨äºå®ç° ```VIPER``` çš„ ```Swift``` ä»£ç ã€‚ åœ¨ä½¿ç”¨è¯¥ä½“ç³»ç»“æ„è¿›è¡Œäº†æ•´æ•´ä¸€å¹´çš„é¡¹ç›®ä¹‹åï¼Œç°åœ¨æˆ‘ç»ˆäºå¯ä»¥ä¸ä½ åˆ†äº«æˆ‘æ‰€æœ‰çš„æœ€ä½³å®è·µã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ ```Xcode``` é¡¹ç›®ï¼Œä½¿ç”¨å•è§†å›¾åº”ç”¨ç¨‹åºæ¨¡æ¿ï¼Œå°†è¯¥é¡¹ç›®å‘½åï¼ˆ  ```VIPERæœ€ä½³å®è·µ``` ï¼‰ï¼Œä½¿ç”¨ ```Swift``` ï¼Œç°åœ¨ä½ å‡†å¤‡å¥½è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œä»¥åˆ¶ä½œå‡ºè‰²çš„ ```â€œä¼ä¸šçº§â€ iOS åº”ç”¨``` ã€‚

<!-- more -->

</br>

# **ç”ŸæˆVIPERæ¨¡å—**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ°¸è¿œä¸è¦æ‰‹åŠ¨åˆ›å»ºæ¨¡å—ï¼Œå§‹ç»ˆä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œå› ä¸ºè¿™æ˜¯ä¸€é¡¹é‡å¤æ€§çš„ä»»åŠ¡ï¼Œè¿™å¾ˆæ— èŠï¼Œè€Œä¸”ä½ åº”è¯¥ä¸“æ³¨äºæ¯”åˆ¶ä½œæ ·æ¿ä»£ç æ›´é‡è¦çš„äº‹æƒ…ã€‚ ä½ å¯ä»¥ä½¿ç”¨è½»é‡çº§æ¨¡å—ç”Ÿæˆå™¨ï¼š

[***```VIPERA```***](https://github.com/binarybirds/swift-template "")

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åªéœ€ä» ```github``` ä¸‹è½½æˆ–å…‹éš†å­˜å‚¨åº“å³å¯ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œ``` swift run install --with-templates``` å®‰è£…äºŒè¿›åˆ¶å·¥å…·ã€‚è¿™ä¼šå°† ```vipera``` åº”ç”¨ç¨‹åºå®‰è£…åœ¨ ```/usr/local/bin/``` ä¸‹ï¼Œå¹¶å°†åŸºæœ¬æ¨¡æ¿å®‰è£…åœ¨ ```ã€œ/.vipera``` ç›®å½•ä¸‹ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ¨¡æ¿ï¼Œä½†æ˜¯ç°åœ¨æˆ‘å°†ä½¿ç”¨é»˜è®¤æ¨¡æ¿ã€‚ ğŸ”¨

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘é€šå¸¸ä»åä¸º ```Main``` çš„æ¨¡å—å¼€å§‹ï¼Œè¿™æ˜¯åº”ç”¨ç¨‹åºçš„æ ¹è§†å›¾ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®ç›®å½•ä¸­è°ƒç”¨ ```vipera Main``` æ¥ç”Ÿæˆå®ƒï¼Œå› æ­¤ç”Ÿæˆå™¨å¯ä»¥ä¸ºæ¨¡æ¿æ–‡ä»¶ä¸­çš„æ ‡é¢˜æ³¨é‡Šä½¿ç”¨æ­£ç¡®çš„é¡¹ç›®åç§°ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡åº”ç”¨æˆ‘çš„ ```Xcode``` çº¦å®šæ¥ç¨å¾®æ•´ç†é¡¹ç›®ç»“æ„ï¼Œè¿™æ„å‘³ç€èµ„æºå°†è½¬åˆ° ```Assetsæ–‡ä»¶å¤¹``` ï¼Œæ‰€æœ‰ ```Swift``` æ–‡ä»¶éƒ½å°†ç§»è‡³ ```Sources``` ç›®å½•ã€‚å¦‚ä»Šï¼Œæˆ‘è¿˜æ›´æ”¹äº† ```AppDelegate.swift ```æ–‡ä»¶ï¼Œå¹¶ä¸º ```UIApplicationDelegate``` åè®®è¿›è¡Œäº†å•ç‹¬çš„æ‰©å±•ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ ```Sources``` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª ```Modulesç»„``` ï¼ˆä¹Ÿæœ‰ä¸€ä¸ªç‰©ç†æ–‡ä»¶å¤¹ï¼‰ï¼Œå¹¶å°†æ–°ç”Ÿæˆçš„ ```Mainæ¨¡å—``` ç§»åˆ°è¯¥ç»„ä¸‹ã€‚ç°åœ¨ï¼Œé€šè¿‡ä» ```Assetsæ–‡ä»¶å¤¹``` ä¸­ä¸ºå½“å‰ç›®æ ‡é€‰æ‹© ```Info.plist``` æ–‡ä»¶æ¥è§£å†³é¡¹ç›®é—®é¢˜ã€‚è¿˜è¦åˆ é™¤ ```Main Interface``` ï¼Œç„¶åä½ å¯ä»¥å®‰å…¨åœ°åˆ é™¤ ```Main.storyboard``` å’Œ ```ViewController.swift``` æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦å®ƒä»¬ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ ```AppDelegate.swift``` æ–‡ä»¶ä¸­ï¼Œä½ å¿…é¡»å°† ```Mainæ¨¡å—``` çš„è§†å›¾æ§åˆ¶å™¨è®¾ç½®ä¸ºæ ¹è§†å›¾æ§åˆ¶å™¨ï¼Œå› æ­¤å®ƒçœ‹èµ·æ¥åº”è¯¥åƒè¿™æ ·ï¼š

``` Swift
import UIKit

@UIApplicationMain
class AppDelegate: UIResponder {

    var window: UIWindow?
}

extension AppDelegate: UIApplicationDelegate {

    func application(_ application: UIApplication,
                     didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {

        self.window = UIWindow(frame: UIScreen.main.bounds)
        self.window?.rootViewController = MainModule().buildDefault()
        self.window?.makeKeyAndVisible()

        return true
    }
}
```

æ­å–œï¼Œä½ å·²ç»åˆ›å»ºäº†ç¬¬ä¸€ä¸ª ```VIPERæ¨¡å—``` ï¼ ğŸ‰

</br>

# **UITabBarController & VIPER**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºåœ¨ ```VIPERæ¨¡å—``` ä¸­ä½¿ç”¨ ```UITabBarController``` ï¼Œæˆ‘æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç”Ÿæˆä¸€äº›æ–°æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å°†æˆä¸º ```Tabs``` ã€‚æˆ‘å°†ä½¿ç”¨ ```JSONPlaceholderæœåŠ¡``` ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸ºæ¯ä¸ªèµ„æºè®¾æƒ³ä¸€ä¸ªå•ç‹¬çš„é€‰é¡¹å¡ï¼šå¸–å­ï¼Œç›¸å†Œï¼Œç…§ç‰‡ï¼Œå¾…åŠäº‹é¡¹ï¼ˆå…·æœ‰ç›¸åŒçš„æ¨¡å—åç§°ï¼‰ã€‚å…¨éƒ¨ç”Ÿæˆå®ƒä»¬ï¼Œç„¶åå°†å…¶ç§»åŠ¨åˆ° ```modulesæ–‡ä»¶å¤¹``` ä¸­ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†ç”Ÿæˆä¸€ä¸ªç§°ä¸º ```Homeçš„æ¨¡å—``` ã€‚è¿™å°†å®ç°æˆ‘ä»¬çš„ ```UITabBarController``` ã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥å°† ```Mainæ¨¡å—``` ç”¨äºæ­¤ç›®çš„ï¼Œä½†æˆ‘æƒ³ä¿ç•™è¯¥åŠ¨ç”»çš„ç›®çš„ï¼Œä»¥ä¾¿åœ¨åŠ è½½å±å¹•å’Œ ```Homeæ¨¡å—``` ä¹‹é—´è¿›è¡Œå·§å¦™çš„è½¬æ¢ï¼ˆè¿™å®Œå…¨å–å†³äºä½ çš„éœ€æ±‚ï¼‰ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å› æ­¤ï¼Œæˆ‘ä»¬è¦å®ç°çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šä¸»è§†å›¾å°†é€šçŸ¥ ```presenter``` æœ‰å…³ ```viewDidAppear``` äº‹ä»¶çš„ä¿¡æ¯ï¼Œ ```presenter``` å°†è¦æ±‚ ```router``` æ˜¾ç¤º ```Homeæ¨¡å—``` ã€‚  ```Homeæ¨¡å—```  çš„è§†å›¾å°†æ˜¯ ```UITabBarController``` çš„å­ç±»ï¼Œå®ƒè¿˜å°†é€šçŸ¥å…¶ ```presenter``` æœ‰å…³ ```viewDidLoad``` çš„ä¿¡æ¯ï¼Œå¹¶ä¸” ```presenter``` å°†ä½¿ç”¨å…¶ ```router``` è¯·æ±‚é€‚å½“çš„ ```tabs``` ã€‚

è¿™æ˜¯æ²¡æœ‰æ¥å£çš„ä»£ç ï¼š

``` Swift
class MainDefaultView: UIViewController {

    var presenter: MainPresenter?

    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)

        self.presenter?.viewDidAppear()
    }
}

extension MainDefaultPresenter: MainPresenter {

    func viewDidAppear() {
        self.router?.showHome()
    }
}

extension MainDefaultRouter: MainRouter {

    func showHome() {
        let viewController = HomeModule().buildDefault()
        self.viewController?.present(viewController, animated: true, completion: nil)
    }
}


extension HomeDefaultView: HomeView {

    func display(_ viewControllers: [UIViewController]) {
        self.viewControllers = viewControllers
    }
}

// MARK: - Home module

extension HomeDefaultPresenter: HomePresenter {

    func setupViewControllers() {
        guard let controllers = self.router?.getViewControllers() else {
            return
        }
        self.view?.display(controllers)
    }

}

extension HomeDefaultRouter: HomeRouter {

    func getViewControllers() -> [UIViewController] {
        return [
            PostsModule().buildDefault(),
            AlbumsModule().buildDefault(),
            PhotosModule().buildDefault(),
            TodosModule().buildDefault(),
        ].map { UINavigationController(rootViewController: $0) }
    }
}

class HomeModule {

    func buildDefault() -> UIViewController {
        /* ... */

        presenter.setupViewControllers()

        return view
    }
}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â€œä¸»é¡µâ€æ¨¡å—æ„å»ºå™¨å‡½æ•°å†…éƒ¨è¿˜æœ‰å¦å¤–ä¸€è¡Œå¯è§¦å‘ ```presenter``` è®¾ç½®æ­£ç¡®çš„è§†å›¾æ§åˆ¶å™¨ã€‚ é‚£åªæ˜¯å› ä¸ºåœ¨åˆå§‹åŒ–è¿‡ç¨‹å®Œæˆä¹‹å‰è°ƒç”¨äº† ```UITabBarController```   ```viewDidLoad``` æ–¹æ³•ã€‚ è¿™ç§è¡Œä¸ºæ˜¯å®Œå…¨æ²¡æœ‰åŠ è½½çš„ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ºäº†ä¿æŒå¯¹è§†å›¾å¼•ç”¨ã€‚ ğŸ˜Š

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ— è®ºå¦‚ä½•ï¼Œç°åœ¨ä½ åœ¨é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªé€‚å½“çš„é€‰é¡¹å¡æ ï¼Œå·²é›†æˆä¸º ```VIPERæ¨¡å—``` ã€‚ ç°åœ¨æ˜¯æ—¶å€™ä»æœåŠ¡å™¨ä¸­è·å–ä¸€äº›æ•°æ®äº†ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªé‡è¦çš„æ•™è®­ï¼šä¸æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ ```VIPERæ¨¡å—``` ã€‚

</br>

# **Services & Entities**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘çš„æ¨¡å—ä¸­æ²¡æœ‰å®ä½“ã€‚ æˆ‘é€šå¸¸å°† ```API``` ï¼Œ ```CoreData``` å’Œ ```è®¸å¤šå…¶ä»–æ•°æ®``` æä¾›ç¨‹åºåŒ…è£…ä¸ºæœåŠ¡ã€‚ è¿™æ ·ï¼Œæ‰€æœ‰ç›¸å…³å®ä½“éƒ½å¯ä»¥è¢«æŠ½è±¡åŒ–ï¼Œå› æ­¤å¯ä»¥è½»æ¾åœ°æ›¿æ¢æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æ¨¡æ‹Ÿï¼‰ï¼Œå¹¶ä¸”æˆ‘æ‰€æœ‰çš„ ```interactors``` éƒ½å¯ä»¥é€šè¿‡åè®®å®šä¹‰ä½¿ç”¨è¯¥æœåŠ¡ï¼Œè€Œæ— éœ€äº†è§£åº•å±‚å®ç°ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦ä¸€ä»¶äº‹æ˜¯ï¼Œå¦‚æœæˆ‘ä¸å¾—ä¸å¤„ç†å¼‚æ­¥ä»£ç ï¼Œæˆ‘æ€»æ˜¯ä½¿ç”¨ [***```promise```***](https://github.com/corekit/promises "") åº“ã€‚ å…¶èƒŒåçš„åŸå› å¾ˆç®€å•ï¼šä¸ä½¿ç”¨å›è°ƒå’Œå¯é€‰çš„ç»“æœå…ƒç´ ç›¸æ¯”ï¼Œå®ƒæ›´ä¼˜é›…ã€‚ ä½ ä¹Ÿåº”è¯¥å­¦ä¹  ```promise``` ã€‚ å› æ­¤ï¼Œè¿™æ˜¯æˆ‘å›´ç»• ```JSONPlaceholder API``` å®ç°æœåŠ¡çš„ä¸€éƒ¨åˆ†ï¼š

``` Swift
protocol Api {

    func posts() -> Promise<[Post]>
    func comments(for post: Post) -> Promise<[Comment]>
    func albums() -> Promise<[Album]>
    func photos(for album: Album) -> Promise<[Photo]>
    func todos() -> Promise<[Todo]>
}

// MARK: - entities

struct Post: Codable {

    let id: Int
    let title: String
    let body: String
}

// MARK: - API implementation

class JSONPlaceholderService {

    var baseUrl = URL(string: "https://jsonplaceholder.typicode.com/")!

    enum Error: LocalizedError {
        case invalidStatusCode
        case emptyData
    }

    private func request<T>(path: String) -> Promise<T> where T: Decodable {
        let promise = Promise<T>()
        let url = baseUrl.appendingPathComponent(path)
        print(url)
        URLSession.shared.dataTask(with: url) { data, response, error in
            if let error = error {
                promise.reject(error)
                return
            }
            guard let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200 else {
                promise.reject(Error.invalidStatusCode)
                return
            }
            guard let data = data else {
                promise.reject(Error.emptyData)
                return
            }
            do {
                let model = try JSONDecoder().decode(T.self, from: data)
                promise.fulfill(model)
            }
            catch {
                promise.reject(error)
            }
        }.resume()
        return promise
    }
}

extension JSONPlaceholderService: Api {

    func posts() -> Promise<[Post]> {
        return self.request(path: "posts")
    }

    /* ... */
}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šå¸¸ï¼Œæˆ‘åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªæ¨¡æ‹ŸæœåŠ¡å®ç°ï¼Œå› æ­¤æˆ‘å¯ä»¥è½»æ¾åœ°æµ‹è¯•æ‰€éœ€çš„ä¸€åˆ‡ã€‚ å¦‚ä½•åœ¨è¿™äº›æœåŠ¡ä¹‹é—´åˆ‡æ¢ï¼Ÿ å¥½å§ï¼Œæˆ‘æœ‰ä¸€ä¸ªå…±äº«çš„ï¼ˆå•äºº-ä¸è¦è®¨åŒæˆ‘ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥çš„ï¼‰åº”ç”¨ç¨‹åºç±»ï¼Œæˆ‘ä¸»è¦å°†å…¶ç”¨äºæ ·å¼è®¾è®¡ï¼Œä½†æˆ‘ä¹Ÿå°†ä¸ä¾èµ–é¡¹æ³¨å…¥ ```ï¼ˆDIï¼‰``` ç›¸å…³çš„ä»£ç æ”¾åœ¨äº†é‚£é‡Œã€‚ è¿™æ ·ï¼Œæˆ‘å¯ä»¥ä¸º ```VIPERæ¨¡å—``` ä¼ é€’é€‚å½“çš„æœåŠ¡å¯¹è±¡ã€‚

``` Swift
class App {

    static let shared = App()

    private init() {

    }

    var apiService: Api {
        return JSONPlaceholderService()
    }
}

// MARK: - module

class PostsModule {

    func buildDefault() -> UIViewController {
        let view = PostsDefaultView()
        let interactor = PostsDefaultInteractor(apiService: App.shared.apiService)

        /* ... */

        return view
    }
}

// MARK: - interactor

class PostsDefaultInteractor {

    weak var presenter: PostsPresenter?

    var apiService: Api

    init(apiService: Api) {
        self.apiService = apiService
    }
}

extension PostsDefaultInteractor: PostsInteractor {

    func posts() -> Promise<[Post]> {
        return self.apiService.posts()
    }

}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½ å¯ä»¥ä½¿ç”¨å…¶ä»–100ç§æ–¹æ³•æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†æ˜¯æˆ‘ç›®å‰æ›´å–œæ¬¢è¿™ç§æ–¹æ³•ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ ```interactors``` å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€äº›é¢å¤–çš„ç»†èŠ‚æ¥è°ƒç”¨æœåŠ¡ï¼Œä¾‹å¦‚è¿‡æ»¤å™¨ï¼Œè®¢å•ï¼Œæ’åºç­‰ã€‚åŸºæœ¬ä¸Šï¼Œè¯¥æœåŠ¡åªæ˜¯ç«¯ç‚¹å‘¨å›´çš„é«˜çº§æ¦‚å¿µåŒ…è£…ï¼Œå¹¶ä¸” ```interactors``` ä¸ºè¯¥æ¥å£åˆ›å»ºç»è¿‡å¾®è°ƒï¼ˆæ›´å¥½ï¼‰çš„ ```API``` ç»™ ```presenter``` ã€‚

</br>

# **promises**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®æ–½ä¸šåŠ¡é€»è¾‘æ˜¯ ```presenter``` çš„ä»»åŠ¡ã€‚ æˆ‘æ€»æ˜¯ä½¿ç”¨ ```Promise``` ï¼Œå› æ­¤åŸºæœ¬çš„ ```Presenter``` å®ç°åªèƒ½å¼‚æ­¥åŠ è½½ä¸€äº›å†…å®¹å¹¶æ˜¾ç¤ºç»“æœï¼Œå¦åˆ™é”™è¯¯ï¼ˆåŠ ä¸ŠåŠ è½½æŒ‡ç¤ºç¬¦ï¼‰åªæœ‰å‡ è¡Œã€‚ æˆ‘ä¸€ç›´åœ¨å°è¯•é€šè¿‡åœ¨è§†å›¾ä¸Šä½¿ç”¨ç›¸åŒçš„åè®®å‘½åçº¦å®šæ¥å®ç°ä¸‰ä¸ªåŸºæœ¬çš„ ```UIå †æ ˆå…ƒç´ ``` ï¼ˆåŠ è½½ï¼Œæ•°æ®ï¼Œé”™è¯¯ï¼‰ã€‚ ğŸ˜‰

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è§†å›¾æ–¹é¢ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯å¾ˆå¥½çš„æ—§çš„é›†åˆè§†å›¾é€»è¾‘ï¼Œè¿™å¤§å¤§å‡å°‘äº†æˆ‘å¿…é¡»ç¼–å†™çš„ä»£ç é‡ã€‚ ä½ å¯ä»¥é‡‡ç”¨ä¼ ç»Ÿæ–¹å¼ï¼Œæ¯•ç«Ÿä¸ºè¡¨æˆ–é›†åˆè§†å›¾å®ç°ä¸€äº›æ•°æ®æºå’Œå§”æ‰˜æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå¤šä»£ç ã€‚ è¿™æ˜¯æˆ‘çš„è§†å›¾ç¤ºä¾‹ï¼š

``` Swift
extension PostsDefaultPresenter: PostsPresenter {

    func viewDidLoad() {
        self.view?.displayLoading()
        self.interactor?.posts()
        .onSuccess(queue: .main) { posts  in
            self.view?.display(posts)
        }
        .onFailure(queue: .main) { error in
            self.view?.display(error)
        }
    }
}

// MARK: - view

class PostsDefaultView: CollectionViewController {

    var presenter: PostsPresenter?

    init() {
        super.init(nibName: nil, bundle: nil)

        self.title = "Posts"
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        self.presenter?.viewDidLoad()
    }
}

extension PostsDefaultView: PostsView {

    func displayLoading() {
        print("loading...")
    }

    func display(_ posts: [Post]) {
        let grid = Grid(columns: 1, margin: UIEdgeInsets(all: 8))

        self.source = CollectionViewSource(grid: grid, sections: [
            CollectionViewSection(items: posts.map { PostViewModel($0) })
        ])
        self.collectionView.reloadData()
    }

    func display(_ error: Error) {
        print(error.localizedDescription)
    }
}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;```cell``` å’Œ ```ViewModel``` åœ¨ ```VIPERæ¨¡å—``` ä¹‹å¤–ï¼Œæˆ‘å€¾å‘äºå°† ```Appæ–‡ä»¶å¤¹``` ä¸“ç”¨äºè‡ªå®šä¹‰åº”ç”¨ç¨‹åºç‰¹å®šçš„è§†å›¾ï¼Œ ```extensions``` ï¼Œ ```view models``` ç­‰ã€‚

``` Swift
class PostCell: CollectionViewCell {

    @IBOutlet weak var textLabel: UILabel!
}


class PostViewModel: CollectionViewViewModel<PostCell, Post> {

    override func config(cell: PostCell, data: Post, indexPath: IndexPath, grid: Grid) {
        cell.textLabel.text = data.title
    }

    override func size(data: Post, indexPath: IndexPath, grid: Grid, view: UIView) -> CGSize {
        let width = grid.width(for: view, items: grid.columns)
        return CGSize(width: width, height: 64)
    }
}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šæœ‰å…³æ­¤é›†åˆè§†å›¾æ¶æ„çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«  [***```æŒæ¡é›†åˆè§†å›¾çš„æ•™ç¨‹```***](http://www.xuebaonline.com/Swift%20UICollectionView%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/ "") ã€‚

<br>

# **æ¨¡å—é€šè®¯**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦ä¸€ä¸ªé‡è¦çš„æ•™è®­æ˜¯å­¦ä¹ å¦‚ä½•åœ¨ä¸¤ä¸ª ```VIPERæ¨¡å—``` ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ é€šå¸¸ï¼Œæˆ‘ä½¿ç”¨ç®€å•çš„å˜é‡-å¦‚æœå¿…é¡»å°†ä¿¡æ¯å‘é€å›åŸå§‹æ¨¡å—ï¼Œåˆ™ä½¿ç”¨ ```delegates``` -åœ¨æ„å»ºæ–¹æ³•ä¸­ä¼ é€’ã€‚ æˆ‘è¿˜å°†å‘ä½ å±•ç¤ºä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹ã€‚

``` Swift
class PostsDefaultRouter {

    weak var presenter: PostsPresenter?
    weak var viewController: UIViewController?
}

extension PostsDefaultRouter: PostsRouter {

    func showComments(for post: Post) {
        let viewController = PostDetailsModule().buildDefault(with: post, delegate: self)
        self.viewController?.show(viewController, sender: nil)
    }
}

extension PostsDefaultRouter: PostDetailsModuleDelegate {

    func toggleBookmark(for post: Post) {
        self.presenter?.toggleBookmark(for: post)
    }
}

// MARK: - details


protocol PostDetailsModuleDelegate: class {
    func toggleBookmark(for post: Post)
}

class PostDetailsModule {

    func buildDefault(with post: Post, delegate: PostDetailsModuleDelegate? = nil) -> UIViewController {
        let view = PostDetailsDefaultView()
        let interactor = PostDetailsDefaultInteractor(apiService: App.shared.apiService,
                                                      bookmarkService: App.shared.bookmarkService)
        let presenter = PostDetailsDefaultPresenter(post: post)

        /* ... */

        return view
    }
}

class PostDetailsDefaultRouter {

    weak var presenter: PostDetailsPresenter?
    weak var viewController: UIViewController?
    weak var delegate: PostDetailsModuleDelegate?
}

extension PostDetailsDefaultRouter: PostDetailsRouter {

    func toggleBookmark(for post: Post) {
        self.delegate?.toggleBookmark(for: post)
    }
}


class PostDetailsDefaultPresenter {

    var router: PostDetailsRouter?
    var interactor: PostDetailsInteractor?
    weak var view: PostDetailsView?

    let post: Post

    init(post: Post) {
        self.post = post
    }
}

extension PostDetailsDefaultPresenter: PostDetailsPresenter {

    func reload() {
        self.view?.setup(with: self.interactor!.bookmark(for: self.post))

        //display loading...
        self.interactor?.comments(for: self.post)
        .onSuccess(queue: .main) { comments in
            self.view?.display(comments)
        }
        .onFailure(queue: .main) { error in
            //display error...
        }
    }

    func toggleBookmark() {
        self.router?.toggleBookmark(for: self.post)
        self.view?.setup(with: self.interactor!.bookmark(for: self.post))
    }
}
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ ```builder``` æ–¹æ³•ä¸­ï¼Œæˆ‘å¯ä»¥è®¿é—® ```VIPERæ¨¡å—``` çš„æ¯ä¸ªç»„ä»¶ï¼Œå› æ­¤æˆ‘å¯ä»¥å°†å˜é‡ç®€å•åœ°ä¼ é€’åˆ°æŒ‡å®šçš„ä½ç½®ï¼ˆå¯¹äº ```delegates``` å‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚ æˆ‘é€šå¸¸åœ¨ ```presenter``` ä¸Šè®¾ç½®è¾“å…¥å˜é‡ï¼Œåœ¨ ```router``` ä¸Šè®¾ç½® ```delegates``` ã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šå¸¸æ˜¯ ```presenter``` éœ€è¦åŸå§‹æ¨¡å—ä¸­çš„æ•°æ®ï¼Œæˆ‘å–œæ¬¢å°† ```delegates``` å­˜å‚¨åœ¨ ```router``` ä¸Šï¼Œå› ä¸ºå¦‚æœå¯¼èˆªæ¨¡å¼å‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘æ ¹æœ¬å°±ä¸éœ€è¦æ›´æ”¹ ```presenter``` ã€‚ è¿™åªæ˜¯ä¸ªäººå–œå¥½ï¼Œä½†æˆ‘å–œæ¬¢ä»£ç ä¸­çš„é£æ ¼ã€‚ åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å¾ˆéš¾å†™ä¸‹è¿™äº›ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä» [***```github```***](https://github.com/theswiftdev/tutorials "") ä¸‹è½½å®Œæˆçš„ç¤ºä¾‹ä»£ç ã€‚

<br>

# æ€»ç»“

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚ä½ æ‰€è§ï¼Œåœ¨æ­¤ ```VIPERä½“ç³»ç»“æ„``` æ•™ç¨‹ä¸­ï¼Œæˆ‘æ­£åœ¨ä½¿ç”¨å„ç§è®¾è®¡æ¨¡å¼ã€‚ æœ‰äººè¯´è¿™æ²¡æœ‰çµä¸¹å¦™è¯ï¼Œä½†æˆ‘ç›¸ä¿¡æˆ‘å‘ç°äº†ä¸€ç§éå¸¸äº†ä¸èµ·çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ©ç”¨æˆ‘çš„ä¼˜åŠ¿åœ¨çŸ­æ—¶é—´å†…æ„å»ºé«˜è´¨é‡çš„åº”ç”¨ç¨‹åºã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å°† ```VIPVMæ¶æ„``` ä¸ ```MVVM``` ä¸ ```Promises``` ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥å°†æ¯ä¸ªé›¶ä»¶æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ã€‚ å·¥ç¨‹è¿‡åº¦ï¼Ÿ ä¹Ÿè®¸ã€‚ å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯å€¼å¾—çš„å¼€é”€ã€‚ ä½ æ€ä¹ˆçœ‹å¾…è¿™ä»¶äº‹ï¼Ÿ 